<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Word Counter WebApp</title>
  <style>
    body { font-family: sans-serif; margin: 2em; transition: background 0.5s; }
    #result { margin-top: 2em; font-size: 1.15em; }
    button { font-size: 1em; padding: .5em 1.2em; margin-right: 1em;}
    #langBtn { background: #eee; border: 1px solid #888; color: #222; }
  </style>
</head>
<body>
  <h1>Word Counter</h1>
  <button id="langBtn">ğŸ‡¬ğŸ‡§ EN</button>
  <button id="start">ğŸ™ï¸ Start Listening</button>
  <button id="stop" disabled>â¹ Stop</button>
  <div id="result"></div>
  <script>
    let recognition;
    let totalWords = 0;
    const wordLimit = 50;  // <- Hier das Limit setzen!
    const resultDiv = document.getElementById('result');
    let wakelock = null;
    let listening = false; 
    let language = 'en-US'; // Aktuelle Sprache, default Englisch

    // Sprachumschalter
    const langBtn = document.getElementById("langBtn");
    langBtn.onclick = () => {
      if (language === 'en-US') {
        language = 'de-DE';
        langBtn.textContent = 'ğŸ‡©ğŸ‡ª DE';
      } else {
        language = 'en-US';
        langBtn.textContent = 'ğŸ‡¬ğŸ‡§ EN';
      }
    };

    // WakeLock wie gehabt
    async function enableWakeLock() {
      if ('wakeLock' in navigator) {
        try {
          wakelock = await navigator.wakeLock.request('screen');
        } catch (err) {
          console.log('WakeLock not available:', err);
        }
      }
    }

    function handleResult(event) {
      let transcript = event.results[event.resultIndex][0].transcript;
      resultDiv.innerHTML += "<br><b>Heard:</b> " + transcript;
      let words = transcript.trim().split(/\s+/).filter(w => w.length > 0);
      let chunk = words.length;
      totalWords += chunk;
      resultDiv.innerHTML += `<br>+${chunk} Words (running total = ${totalWords})`;
      if (totalWords >= wordLimit) {
        document.body.style.backgroundColor = "red";
        resultDiv.innerHTML += `<br><b style="font-size:2em; color:white; background:red;">Limit reached!</b>`;
        recognition.stop();
        listening = false;
        document.getElementById('start').disabled = false;
        document.getElementById('stop').disabled = true;
      }
    }

    document.getElementById('start').onclick = () => {
      if (listening) return;
      listening = true;
      totalWords = 0;
      resultDiv.innerHTML = "";
      document.body.style.backgroundColor = ""; // Reset bg
      enableWakeLock();
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        alert("Sorry, your browser does not support Speech Recognition.");
        return;
      }
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.lang = language;
      recognition.continuous = true;
      recognition.interimResults = false;
      recognition.onresult = handleResult;
      recognition.onend = () => {
        // Automatisch neu starten solange Limit nicht erreicht
        if (listening && totalWords < wordLimit) {
          recognition.start();
        } else {
          document.getElementById('start').disabled = false;
          document.getElementById('stop').disabled = true;
          listening = false;
        }
      };
      recognition.start();
      document.getElementById('start').disabled = true;
      document.getElementById('stop').disabled = false;
    };

    document.getElementById('stop').onclick = () => {
      if (recognition) recognition.stop();
      document.getElementById('start').disabled = false;
      document.getElementById('stop').disabled = true;
      listening = false;
    }
  </script>
</body>
</html>
